services:
  - type: web
    name: sigmamail-backend
    runtime: docker
    dockerContext: ./backend
    dockerfilePath: ./backend/Dockerfile
    dockerCommand: node index.js
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGO_URI
        sync: false
      - key: REDIS_URL
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_REDIRECT_URI
        sync: false
      - key: GOOGLE_PUBSUB_TOPIC
        sync: false
      - key: GEMINI_API_KEY
        sync: false
      - key: GEMINI_MODEL
        value: gemini-2.5-flash
      - key: GEMINI_TIMEOUT_MS
        value: "12000"
      - key: GEMINI_MAX_RETRIES
        value: "1"
      - key: CORS_ORIGINS
        sync: false
      - key: CLOUDINARY_CLOUD_NAME
        sync: false
      - key: CLOUDINARY_API_KEY
        sync: false
      - key: CLOUDINARY_API_SECRET
        sync: false
      - key: EMBEDDING_URL
        sync: false
      - key: CLASSIFIER_EMBED_URL
        sync: false

  - type: worker
    name: sigmamail-worker-gmail-push
    runtime: docker
    dockerContext: ./backend
    dockerfilePath: ./backend/Dockerfile
    dockerCommand: node workers/gmailPush.worker.js
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGO_URI
        sync: false
      - key: REDIS_URL
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_REDIRECT_URI
        sync: false
      - key: GOOGLE_PUBSUB_TOPIC
        sync: false
      - key: CLOUDINARY_CLOUD_NAME
        sync: false
      - key: CLOUDINARY_API_KEY
        sync: false
      - key: CLOUDINARY_API_SECRET
        sync: false
      - key: EMBEDDING_URL
        sync: false
      - key: CLASSIFIER_EMBED_URL
        sync: false

  - type: worker
    name: sigmamail-worker-gmail-message-sync
    runtime: docker
    dockerContext: ./backend
    dockerfilePath: ./backend/Dockerfile
    dockerCommand: node workers/gmailMessageSync.worker.js
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGO_URI
        sync: false
      - key: REDIS_URL
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_REDIRECT_URI
        sync: false
      - key: GOOGLE_PUBSUB_TOPIC
        sync: false
      - key: CLOUDINARY_CLOUD_NAME
        sync: false
      - key: CLOUDINARY_API_KEY
        sync: false
      - key: CLOUDINARY_API_SECRET
        sync: false
      - key: EMBEDDING_URL
        sync: false
      - key: CLASSIFIER_EMBED_URL
        sync: false

  - type: worker
    name: sigmamail-worker-gmail-initial-sync
    runtime: docker
    dockerContext: ./backend
    dockerfilePath: ./backend/Dockerfile
    dockerCommand: node workers/gmailInitialSync.worker.js
    autoDeploy: true
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGO_URI
        sync: false
      - key: REDIS_URL
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_REDIRECT_URI
        sync: false
      - key: GOOGLE_PUBSUB_TOPIC
        sync: false
      - key: CLOUDINARY_CLOUD_NAME
        sync: false
      - key: CLOUDINARY_API_KEY
        sync: false
      - key: CLOUDINARY_API_SECRET
        sync: false
      - key: EMBEDDING_URL
        sync: false
      - key: CLASSIFIER_EMBED_URL
        sync: false
